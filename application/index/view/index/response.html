<!DOCTYPE html>
<html lang="en">
<!-- ç­”é¢˜é¡µé¢ -->

<head>
    <meta charset="UTF-8">
    <title>ç­”é¢˜</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="stylesheet" href="/static/index/mui/css/style.css">
    <link rel="stylesheet" href="/static/index/mui/css/mui.min.css">
    <script src="/static/index/mui/js/app.js"></script>
    <script src="/static/index/mui/js/mui.min.js"></script>
    <script src="/static/index/mui/js/style.js"></script>
    <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
    <!-- å¼•å…¥muiæ ·å¼ -->
    <!-- è‡ªå·±çš„æ ·å¼ -->
    <link rel="stylesheet" href="/static/index/my/response.css">
</head>

<body onload="RunOnBeforeUnload()">

<header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title">ç­”é¢˜</h1>
    <a href="{:url('index/Login/index')}" class="right-head">
        {empty name="Request.session.user_name"}
        æš‚æ— è´¦å·
        {else /}
        {$Request.session.user_name}
        {/empty}
    </a>
</header>
<div class="mui-content">
    <h4 class="residue">ç­”é¢˜å‰©ä½™æ—¶é—´ï¼š<span id="timeout"></span></h4> Â 
    <div class="topic-name">é¢˜ç›®åå­—ï¼š<span id="topic"></span></div>

    <ul class="mui-table-view mui-table-view-radio">
    </ul>

    <div>
        <button onclick="submit()" type="button" class="mui-btn mui-btn-primary submit">æäº¤æœ¬é¢˜</button>
    </div>
    <div class="response-skip">
        <a id="previous-css">ä¸Šé¢˜ç­”æ¡ˆ:<span id="previous"></span></a>
        <a id="descend" onclick="private()">ä¸‹ä¸€é¢˜</a>
    </div>
    <p class="rule">ç‚¹å‡»é€‰é¡¹å³å¯ï¼Œè§„åˆ™ç­”é¢˜æœŸé—´è¯·å‹¿â€œåˆ·æ–°â€é¡µé¢(â€œå¦‚æœä½ åˆ·æ–°é¡µé¢ä»£è¡¨ä½ å·²ç»ç­”é¢˜ï¼Œè¿›å…¥ä¸‹ä¸€é¢˜â€)</p>

    <input type="hidden" name="choose_id" id="choose_id" value="">
    <input type="hidden" name="topic_id" id="topic_id" value="">
    <input type="hidden" name="choose" id="choose" value="">
    <input type="hidden" name="answer_id" id="answer_id" value="">
    <input type="hidden" name="answer_uniqueness" id="answer_uniqueness" value="">

</div>

<nav class="mui-bar mui-bar-tab">
    <a onclick="home()" class="mui-tab-item mui-active">
        <span class="mui-icon mui-icon-home"></span>
        <span class="mui-tab-label">é¦–é¡µ</span>
    </a>
    <a onclick="mi()" class="mui-tab-item">
        <span class="mui-icon mui-icon-contact"></span>
        <span class="mui-tab-label">æˆ‘çš„</span>
    </a>
</nav>

</body>

</html>

<script>
    // æäº¤/ä¸‹ä¸€é¢˜
    function submit() {
        /*
        å°†é¢˜æ’å…¥åˆ°æ•°æ®åº“
        */
        var num = localStorage.getItem('count');
        num = Number(num);
        var number = num + 1;//ç”¨æˆ·ç­”é¢˜çš„æ¬¡æ•°ï¼ˆå½“ä¸º10çš„æ—¶å€™åˆ¤æ–­ä»–çš„æ­£ç¡®ç‡æ˜¯å¦å¯ä»¥å»æŠ½å¥–ï¼‰
        var choose_id = $("#choose_id").val();//æ‰€æœ‰é€‰é¡¹id
        var topic_id = $("#topic_id").val();//æœ¬é¢˜çš„id
        var choose = $("#choose").val();//ç”¨æˆ·é€‰æ‹©çš„ç­”æ¡ˆID
        var answer_id = $("#answer_id").val();//æ´»åŠ¨çš„id
        var answer_uniqueness = $("#answer_uniqueness").val();//å”¯ä¸€æ ‡è¯†
        console.log(number);
        $.ajax({
            type: 'POST',
            url: "{:url('index/index/in_answer')}",
            data: {
                topic_id: topic_id,
                choose: choose,
                answer_id: answer_id,
                number: number,
                answer_uniqueness:answer_uniqueness
            },
            dataType: 'json',
            success: function (ins) {
                // console.log(ins);
                if(ins == 6){
                    mui.alert('æ­å–œä½ ä½ å¯ä»¥æŠ½å¥–äº†');
                    window.location.href = "{:url('index/index/draw')}";
                }
                if(ins == 7){
                    mui.toast('å¯¹ä¸èµ·ä½ æ— æ³•æŠ½å¥–');
                    window.location.href = "{:url('index/index/index')}";
                }
                if (ins[0] == 0) {
                    if (ins[1] == 0) {
                        mui.toast('ç­”é¢˜æˆåŠŸï¼Œç­”é¢˜é”™è¯¯äº†ğŸ˜¥');
                    }
                    if (ins[1] == 1) {
                        mui.toast('ç­”é¢˜æˆåŠŸï¼Œç­”é¢˜æ­£ç¡®ğŸ˜€');
                    }
                }else{
                    mui.toast('ç½‘ç»œé”™è¯¯');
                }
                $("#previous").html(ins[2]);
            },
            error: function () {
                console.log("error");
            }
        });
        count();//è¿™ä¸ªæ˜¯ä¸‹ä¸€é¢˜çš„æ“ä½œ
        jumpurl();//æ˜¾ç¤ºé¢˜çš„æ“ä½œ 
        replacement()//é‡æ–°è®¡æ—¶çš„æ“ä½œ
    }
</script>


<script>
    //è®¡ç®—è¿™æ˜¯ç¬¬å‡ é¢˜
    function count() {
        // å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒlocalStorage
        if (window.localStorage) {
            // æ˜¯å¦å·²ç»æœ‰è®°å½•äº†ï¼Œå¦‚æœæœ‰è¿›å…¥æ“ä½œ
            if (window.localStorage.getItem("count")) {
                //æ‹¿å‡ºkeyå¯¹åº”çš„valueï¼Œ å› ä¸ºå­˜å‚¨è¿›å»çš„æ˜¯å­—ç¬¦ä¸²ã€‚
                var c = parseInt(window.localStorage.getItem("count"));
                // è®¾ç½®keyï¼ŒvalueåŠ 1
                window.localStorage.setItem("count", c + 1);
                // console.log(parseInt(window.localStorage.getItem("count")));
            } else {
                //å¦‚æœæ²¡æœ‰æ£€æŸ¥åˆ°key, é‚£è‚¯å®šæ²¡è®¾ç½®ï¼Œé‚£å°±è®©ä»–é»˜è®¤ä¸º0
                window.localStorage.setItem("count", 0);
            }
        }
    }
</script>

<script>
    //é€‰æ‹©é¢˜èµ‹å€¼
    var list = document.querySelector('.mui-table-view.mui-table-view-radio');
    list.addEventListener('selected', function (e) {
        var choose = e.detail.el.getElementsByTagName('i')[0].innerText;
        document.getElementById('choose').value = choose;
    });

</script>


<script type="text/javascript">
    var num = localStorage.getItem('count');
    if (num) {
    } else {
        window.localStorage.setItem("count", 0);//åˆå§‹å€¼ï¼Œç¬¬ä¸€æ¬¡è¿›æ¥å°±æ˜¯ç¬¬ä¸€é¢˜
    }
    data = sessionStorage.all;
    all = JSON.parse(data);
    // è¿™æ˜¯éšæœºçš„10ä¸ªæ•°ç»„
    // console.log(all);
    function jumpurl() {
        var num = localStorage.getItem('count');
        for (i = 0; i < 1; i++) {
            $("#topic").text(all[num].topic_name);
            $("#choose_id").val(all[num].choose_id);
            $("#topic_id").val(all[num].id);
            $("#answer_id").val(all[num].answer_id);
            $("#answer_uniqueness").val(all[num].uniqueness);
        }
        //è¯·æ±‚é€‰é¡¹
        var choose_id = $("#choose_id").val();//æ‰€æœ‰é€‰é¡¹çš„id
        var topic_id = $("#topic_id").val();//é¢˜çš„id
        $.ajax({
            type: 'POST',
            url: "{:url('index/index/particular')}",
            data: {
                choose_id: choose_id,
                topic_id: topic_id,
            },
            dataType: 'json',
            success: function (choose) {
                // console.log(choose);
                var html = "";
                html += '<ul class="mui-table-view mui-table-view-radio">';
                for (var i = 0; i < choose.length; i++) {
                    var ch_small = 'A';
                    var str_small = '';
                    str_small += String.fromCharCode(ch_small.charCodeAt(0) + i);
                    html += "<li class='mui-table-view-cell'>";
                    html += "<a class='mui-navigate-right'>" + str_small + "ï¼š " + "<span id= 'selected'>" + choose[i].choose_name + "</span>" + "<i id = 'choose_id'>" + choose[i].id + "</i>" + "</a>";
                    html += "</li>";
                    // html += "<li class='mui-table-view-cell'>" + str_small + "ï¼š " + choose[i].choose_name + "</li>";
                }
                html += "</ul>";
                $(".mui-table-view").html(html); //è¯»å–ä¸‹çº§çš„ä¿¡æ¯
            },
            error: function () {
                console.log("error");
            }
        });
    }

    (function () {
        jumpurl();
    })();
</script>


<!--å€’è®¡æ—¶é—®é¢˜-->
<script>
    var DOwn = 50;
    var Invoking;

    function Initiation() {
        DOwn = DOwn - 1;
        Invoking = setTimeout("Initiation()", 1000);
        if (DOwn == 0) {
            submit();
            replacement();
            // alert("æ—¶é—´åˆ°");//æäº¤é¢˜
        }
        document.getElementById("timeout").innerHTML = DOwn;
    }

    function stopCount() {
        clearTimeout(Invoking);
    }

    function replacement() {
        DOwn = 50;
    }

    Initiation();

</script>

<!--é˜²æ­¢é¡µé¢åˆ·æ–°çš„é—®é¢˜-->
<script type="text/javascript">
    function RunOnBeforeUnload() {
        window.onbeforeunload = function () {
            return 'è¯·ä¸è¦åˆ·æ–°é¡µé¢!';
        }
    }
</script>
</head>